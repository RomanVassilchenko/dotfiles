# Pre-commit hooks for NixOS dotfiles
# Install: pre-commit install
# Run manually: pre-commit run --all-files
#
# This configuration runs nixfmt-rfc-style on all .nix files before commit

repos:
  - repo: local
    hooks:
      - id: nixfmt
        name: nixfmt
        description: Format Nix files with nixfmt-rfc-style
        entry: nixfmt
        language: system
        files: \.nix$
        exclude: |
          (?x)^(
            secrets/.*|
            result/.*
          )$

      - id: nix-flake-check
        name: nix flake check
        description: Validate flake configuration
        entry: bash -c 'timeout 120 nix flake check --no-build 2>&1 || echo "Warning: flake check timed out or failed"'
        language: system
        files: \.nix$
        pass_filenames: false
        stages: [commit]

      - id: shellcheck
        name: shellcheck
        description: Check shell scripts for errors
        entry: shellcheck
        language: system
        types: [shell]
        exclude: |
          (?x)^(
            result/.*
          )$

      - id: trailing-whitespace
        name: trailing-whitespace
        description: Remove trailing whitespace
        entry: bash -c 'git diff --cached --name-only | xargs -I {} sed -i "s/[[:space:]]*$//" {}'
        language: system
        pass_filenames: false
        stages: [commit]

      - id: check-merge-conflict
        name: check-merge-conflict
        description: Check for merge conflict markers
        entry: bash -c 'git diff --cached --name-only | xargs grep -l "^<<<<<<< " 2>/dev/null && exit 1 || exit 0'
        language: system
        pass_filenames: false
        stages: [commit]
